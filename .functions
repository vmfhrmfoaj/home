#!/bin/bash

_install_vs_code_from_tar() {
    local tar_file=$1
    local target_dir=${2:-"${HOME}/.vscode"}
    if [ -z ${tar_file} ]; then
        echo "Usage: $0 [TAR_FILE] [TARGET_DIR]?"
        return 255
    fi

    mkdir -p "${target_dir}"
    tar -C "${target_dir}" -xf "${tar_file}" --strip-components=1 'VSCode-linux-x64'
    if [ $? -ne 0 ]; then
        >&2 echo "Can't unpack '${tar_file}' to '${target_dir}'"
        return 255;
    fi

    local sym_file="${HOME}/.bin/code"
    rm -rf "${sym_file}"
    ln -rs "${target_dir}/bin/code" "${sym_file}"
    if [ $? -ne 0 ]; then
        >&2 echo "Can't create a symbolic link at '${sym_file}'"
        return 255;
    fi
    cat > "${HOME}/.local/share/applications/visual-studio-code.desktop" <<EOF
[Desktop Entry]
Type=Application
Version=$(${target_dir}/bin/code --version | head -1)
Name=Visual Studio Code
GenericName=VS Code
Comment=Multiplatform Visual Studio Code from Microsoft
Icon=${target_dir}/resources/app/resources/linux/code.png
TryExec="${target_dir}/bin/code"
Exec="${target_dir}/bin/code" %F
Terminal=true
MimeType=text/css;text/english;text/html;text/plain;text/x-c;text/x-chdr;text/x-csrc;text/x-c++;text/x-c++hdr;text/x-c++src;text/x-java;text/x-makefile;text/x-moc;text/x-pascal;text/x-tcl;text/x-tex;application/x-shellscript;
Categories=Development;IDE;TextEditor;
StartupWMClass=Code
EOF
    return 0
}
